# ๐๏ธ ุฏููู ูุงุนุฏุฉ ุงูุจูุงูุงุช - ูุธุงู POS

## ๐ **ูุธุฑุฉ ุนุงูุฉ**

ูุฐุง ุงููุดุฑูุน ูุณุชุฎุฏู ูุงุนุฏุฉ ุจูุงูุงุช `hrmsnat` ููู ูุงุนุฏุฉ ูุญุงุณุจูุฉ ูุชูุงููุฉ ุชุฏุนู:
- โ ูุธุงู POS (ููุงุท ุงูุจูุน)
- โ ูุธุงู ูุญุงุณุจู ูุงูู
- โ ุฅุฏุงุฑุฉ ุงููุฎุฒูู
- โ ุฅุฏุงุฑุฉ ุงูููุธููู ูุงูุฑูุงุชุจ
- โ ูุธุงู ุงูุนูุงุฏุงุช
- โ ูุธุงู ุงูุญุฌูุฒุงุช

---

## ๐ **ูููู ุงููููุงุช**

```
horstec/
โโโ dbase/
โ   โโโ musk-2024-06-14.sql          # ุงููุงุนุฏุฉ ุงูุฃุณุงุณูุฉ (95 ุฌุฏูู)
โโโ backup/                          # ูุณุฎ ุงุญุชูุงุทูุฉ
โโโ DATABASE_ANALYSIS.md             # ๐ ุชุญููู ุงููุงุนุฏุฉ ุงูุญุงููุฉ
โโโ DATABASE_IMPROVEMENTS_SUMMARY.md # ๐ ููุฎุต ุงูุชุญุณููุงุช
โโโ MIGRATION_GUIDE.md               # ๐ ุฏููู ุงูุชูููุฐ
โโโ 001_add_indexes.sql              # โก Indexes ููุฃุฏุงุก
โโโ 002_add_missing_pos_tables.sql   # ๐ ุฌุฏุงูู ุฌุฏูุฏุฉ
โโโ 003_add_missing_columns.sql      # โ ุฃุนูุฏุฉ ุฅุถุงููุฉ
โโโ 004_create_useful_views.sql      # ๐๏ธ Views ููุชูุงุฑูุฑ
โโโ 005_optimize_datatypes.sql       # ๐ง ุชุญุณูู ุฃููุงุน ุงูุจูุงูุงุช
โโโ run_migrations.php               # ๐ ุฃุฏุงุฉ ุชูููุฐ ุชููุงุฆู
โโโ test_improvements.php            # ๐งช ุฃุฏุงุฉ ุงุฎุชุจุงุฑ

```

---

## ๐ฏ **ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ**

### **๐ฆ ุงูุฃุตูุงู ูุงููุฎุฒูู**
```sql
myitems          -- ุงูุฃุตูุงู ุงูุฑุฆูุณูุฉ
item_group       -- ุงูุชุตููู ุงูุฃูู  
item_group2      -- ุงูุชุตููู ุงูุซุงูู
item_group3      -- ุงูุชุตููู ุงูุซุงูุซ
imgs             -- ุตูุฑ ุงูุฃุตูุงู
item_units       -- ูุญุฏุงุช ุงูููุงุณ
```

### **๐ฐ ุงููุจูุนุงุช ูุงูููุงุชูุฑ**
```sql
ot_head          -- ุฑุฃุณ ุงููุงุชูุฑุฉ
fat_details      -- ุชูุงุตูู ุงูุฃุตูุงู ูู ุงููุงุชูุฑุฉ
fat_tybes        -- ุฃููุงุน ุงูููุงุชูุฑ
```

### **๐ฅ ุงูุนููุงุก ูุงูููุฑุฏูู**
```sql
acc_head         -- ุงูุญุณุงุจุงุช (ุนููุงุกุ ููุฑุฏููุ ุตูุงุฏููุ ูุฎุงุฒู)
clients          -- ุนููุงุก ุงูุนูุงุฏุงุช
```

### **๐จโ๐ผ ุงููุณุชุฎุฏููู ูุงูุตูุงุญูุงุช**
```sql
users            -- ุงููุณุชุฎุฏููู
employees        -- ุงูููุธููู
mypowers         -- ุงูุตูุงุญูุงุช
usr_pwrs         -- ุตูุงุญูุงุช ุงููุณุชุฎุฏููู
```

### **๐ ุงููุญุงุณุจุฉ**
```sql
journal_entries  -- ุงููููุฏ ุงูููููุฉ
journal_heads    -- ุฑุคูุณ ุงููููุฏ
acc_groups       -- ูุฌููุนุงุช ุงูุญุณุงุจุงุช
cost_centers     -- ูุฑุงูุฒ ุงูุชูููุฉ
```

---

## ๐ **ุงูุฃุนูุฏุฉ ุงููููุฉ**

### **myitems (ุงูุฃุตูุงู)**
```sql
id              -- ุงููุนุฑู
iname           -- ุงุณู ุงูุตูู
barcode         -- ุงูุจุงุฑููุฏ
price1, price2, price3  -- ุฃุณุนุงุฑ ุงูุจูุน
cost_price      -- ุณุนุฑ ุงูุชูููุฉ
itmqty          -- ุงููููุฉ ุงููุชููุฑุฉ
group1, group2, group3  -- ุงูุชุตูููุงุช
isdeleted       -- ูุญุฐููุ
```

### **ot_head (ุงูููุงุชูุฑ)**
```sql
id              -- ุงููุนุฑู
pro_num         -- ุฑูู ุงููุงุชูุฑุฉ
pro_date        -- ุชุงุฑูุฎ ุงููุงุชูุฑุฉ
pro_tybe        -- ููุน ุงูุนูููุฉ (9 = ูุจูุนุงุช)
acc1            -- ุงูุนููู
acc2            -- ุงูุตูุฏูู
emp_id          -- ุงูููุธู/ุงููุงุดูุฑ
store_id        -- ุงููุฎุฒู
fat_total       -- ุงูุฅุฌูุงูู
fat_disc        -- ุงูุฎุตู
fat_tax         -- ุงูุถุฑูุจุฉ
```

### **fat_details (ุฃุตูุงู ุงููุงุชูุฑุฉ)**
```sql
id              -- ุงููุนุฑู
pro_id          -- ุฑูู ุงููุงุชูุฑุฉ (ot_head.id)
item_id         -- ุฑูู ุงูุตูู (myitems.id)
qty_out         -- ุงููููุฉ ุงููุจุงุนุฉ
price           -- ุณุนุฑ ุงููุญุฏุฉ
det_value       -- ูููุฉ ุงูุณุทุฑ
cost_price      -- ุณุนุฑ ุงูุชูููุฉ
```

---

## ๐ **ุงูุนูุงูุงุช ุงูุฃุณุงุณูุฉ**

```
item_group (1) โโ (N) myitems
    โโ group1

myitems (1) โโ (N) imgs
    โโ itemid

myitems (1) โโ (N) fat_details
    โโ item_id

ot_head (1) โโ (N) fat_details
    โโ pro_id

acc_head (1) โโ (N) ot_head
    โโ acc1 (ุงูุนููู)
    โโ acc2 (ุงูุตูุฏูู)
    โโ store_id (ุงููุฎุฒู)
    โโ emp_id (ุงูููุธู)
```

---

## ๐ **ุงูุจุฏุก ุงูุณุฑูุน**

### **1. ุงุฎุชุจุงุฑ ุงููุงุนุฏุฉ ุงูุญุงููุฉ:**
```
ุงูุชุญ: http://localhost/horstec/test_improvements.php
```

### **2. ุชูููุฐ ุงูุชุญุณููุงุช:**
```
ุงูุชุญ: http://localhost/horstec/run_migrations.php?confirm=yes
```

### **3. ุงุฎุชุจุงุฑ POS:**
```
ุงูุชุญ: http://localhost/horstec/pos_barcode.php
```

---

## ๐ **ุงุณุชุนูุงูุงุช ูููุฏุฉ**

### **ุนุฑุถ ุฌููุน ุงูุฃุตูุงู ูุน ุงูุตูุฑ:**
```sql
SELECT * FROM vw_products_with_images;
```

### **ุงูุฃุตูุงู ุงูุฃูุซุฑ ูุจูุนุงู:**
```sql
SELECT * FROM vw_top_selling_products LIMIT 20;
```

### **ุชูุจูู ุงููุฎุฒูู ุงูููุฎูุถ:**
```sql
SELECT * FROM vw_low_stock_alert;
```

### **ูุจูุนุงุช ุงูููู:**
```sql
SELECT * FROM vw_daily_sales_report 
WHERE sale_date = CURDATE();
```

### **ุฃุฑุจุงุญ ุงูุดูุฑ:**
```sql
SELECT 
    SUM(gross_profit) as total_profit,
    AVG(profit_margin_percentage) as avg_margin
FROM vw_profit_analysis
WHERE sale_date >= DATE_FORMAT(NOW(), '%Y-%m-01');
```

---

## ๐๏ธ **ุงูุตูุงูุฉ**

### **Backup ูููู:**
```bash
# ูู Task Scheduler ุฃู Cron
C:\xampp\mysql\bin\mysqldump -u root hrmsnat > backup\backup_%date%.sql
```

### **ุชูุธูู ุฏูุฑู:**
```sql
-- ุญุฐู ุงูุณุฌูุงุช ุงููุฏููุฉ ูู audit_logs (ุฃูุฏู ูู ุณูุฉ)
DELETE FROM audit_logs WHERE crtime < DATE_SUB(NOW(), INTERVAL 1 YEAR);

-- ุชุญุณูู ุงูุฌุฏุงูู
OPTIMIZE TABLE myitems, ot_head, fat_details;

-- ุชุญููู ุงูุฌุฏุงูู
ANALYZE TABLE myitems, ot_head, fat_details;
```

### **ูุฑุงูุจุฉ ุงูุญุฌู:**
```sql
SELECT 
    table_name,
    ROUND((data_length + index_length) / 1024 / 1024, 2) AS size_mb,
    table_rows
FROM information_schema.tables
WHERE table_schema = 'hrmsnat'
ORDER BY (data_length + index_length) DESC
LIMIT 20;
```

---

## ๐ **ุงูุฃูุงู**

### **Soft Delete:**
ุงููุธุงู ูุณุชุฎุฏู `isdeleted = 0/1` - ูุง ูุญุฐู ุงูุจูุงูุงุช ูุนููุงู

### **Triggers:**
```sql
-- ุชุญุฏูุซ ุงููุฎุฒูู ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ/ุชุนุฏูู ูุงุชูุฑุฉ
update_balance_trigger (on fat_details INSERT)
update_after_update (on fat_details UPDATE)
```

### **Foreign Keys:**
โ๏ธ ุบูุฑ ูููุนููุฉ ุญุงููุงู (ููุชูุงูู ูุน ุงูุจูุงูุงุช ุงููุฏููุฉ)
ูููู ุฅุถุงูุชูุง ูุงุญูุงู ุจุนุฏ ุชูุธูู ุงูุจูุงูุงุช

---

## ๐ **ุงูุฏุนู**

### **ุงููููุงุช ุงููุฑุฌุนูุฉ:**
- `DATABASE_ANALYSIS.md` - ุชุญููู ูุงูู
- `MIGRATION_GUIDE.md` - ุฏููู ุฎุทูุฉ ุจุฎุทูุฉ
- `DATABASE_IMPROVEMENTS_SUMMARY.md` - ููุฎุต ุงูุชุญุณููุงุช

### **ุงุฎุชุจุงุฑ:**
- `test_improvements.php` - ูุญุต ุงูุญุงูุฉ
- `run_migrations.php` - ุชูููุฐ ุงูุชุญุณููุงุช

---

## ๐ **ูุตุทูุญุงุช**

| ุงููุตุทูุญ | ุงููุนูู |
|---------|--------|
| Migration | ููู ุชุญุฏูุซ ุงููุงุนุฏุฉ |
| Index | ููุฑุณ ูุชุณุฑูุน ุงูุจุญุซ |
| View | ุงุณุชุนูุงู ูุญููุธ |
| FK | Foreign Key (ููุชุงุญ ุฃุฌูุจู) |
| Soft Delete | ุญุฐู ููุทูู (isdeleted = 1) |
| Trigger | ุฅุฌุฑุงุก ุชููุงุฆู |

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-10-17  
**ุงูุฅุตุฏุงุฑ:** 1.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู

