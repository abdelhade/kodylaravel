# ๐ฝ๏ธ ุฏููู ูุธุงู ุงูุทุงููุงุช - Tables System Guide

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฏูุฌ ูุธุงู ุงูุทุงููุงุช ุจุงููุงูู ูุน ูุธุงู POS ูุชูููุฑ ุชุฌุฑุจุฉ ุณูุณุฉ ูุฅุฏุงุฑุฉ ุทูุจุงุช ุงููุทุงุนู ูุงููุงูููุงุช.

---

## ๐ฏ ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

### โ **1. ุฅุฏุงุฑุฉ ุงูุทุงููุงุช**
- ุนุฑุถ ุฌููุน ุงูุทุงููุงุช ุจุดูู ูุฑุฆู
- ุชูููุฒ ุงูุทุงููุงุช ุงููุชุงุญุฉ (ุฃุฎุถุฑ) ูุงููุดุบููุฉ (ุฃุญูุฑ)
- ุนุฑุถ ุฅุฌูุงูู ุงูุทูุจ ุงููุดุท ุนูู ูู ุทุงููุฉ ูุดุบููุฉ
- ุงุฎุชูุงุฑ ุงูุทุงููุฉ ุจุถุบุทุฉ ูุงุญุฏุฉ

### โ **2. ุฅุฏุงุฑุฉ ุงูุทูุจุงุช**
- ูุชุญ ุทูุจ ุฌุฏูุฏ ููุทุงููุฉ ุงููุงุถูุฉ
- ุชุญููู ุงูุทูุจ ุงููุดุท ุชููุงุฆูุงู ููุทุงููุฉ ุงููุดุบููุฉ
- ุฅุถุงูุฉ ุฃุตูุงู ุฌุฏูุฏุฉ ุนูู ุทูุจ ูุงุฆู
- ุญูุธ ุงูุทูุจ ูุคูุชุงู (ูุจูู ููุชูุญุงู)
- ุฅุบูุงู ุงูุทูุจ ุนูุฏ ุงูุฏูุน ุงููุงูู

### โ **3. ุญุงูุงุช ุงูุทูุจ**
- **draft**: ูุณูุฏุฉ (ุบูุฑ ูุณุชุฎุฏูุฉ ุญุงููุงู)
- **active**: ุทูุจ ูุดุทุ ุงูุทุงููุฉ ูุดุบููุฉ
- **completed**: ุทูุจ ููุชููุ ุชู ุงูุฏูุน ุจุงููุงูู
- **cancelled**: ุทูุจ ููุบู (ููุงุณุชุฎุฏุงู ุงููุณุชูุจูู)

---

## ๐ ุฏูุฑุฉ ุงูุนูู ุงููุงููุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  1๏ธโฃ ูุชุญ ูุธุงู POS                                   โ
โ     โ pos_barcode.php                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  2๏ธโฃ ุงุฎุชูุงุฑ ุงูุทุงููุฉ                                 โ
โ     โ ุงูุถุบุท ุนูู ุฒุฑ "ุงุฎุชุฑ ุทุงููุฉ"                    โ
โ     โ ููุชุญ modal ูุนุฑุถ ุฌููุน ุงูุทุงููุงุช                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  3๏ธโฃ ุงูุณููุงุฑูู A: ุทุงููุฉ ูุงุถูุฉ (ูุชุงุญุฉ)              โ
โ     โ ุทูุจ ุฌุฏูุฏ                                      โ
โ     โ ุงูุจุฏุก ูู ุฅุถุงูุฉ ุงูุฃุตูุงู                        โ
โ     โ ุงูุทุงููุฉ ุชุตุจุญ "ูุดุบููุฉ" ุนูุฏ ุงูุญูุธ               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  4๏ธโฃ ุงูุณููุงุฑูู B: ุทุงููุฉ ูุดุบููุฉ                     โ
โ     โ ุชุญููู ุงูุทูุจ ุงููุดุท ุชููุงุฆูุงู                   โ
โ     โ ุนุฑุถ ุงูุฃุตูุงู ุงูููุฌูุฏุฉ                         โ
โ     โ ุฅููุงููุฉ ุฅุถุงูุฉ ุฃุตูุงู ุฌุฏูุฏุฉ                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  5๏ธโฃ ุฅุถุงูุฉ ุงูุฃุตูุงู                                  โ
โ     โ ูุณุญ ุงูุจุงุฑููุฏ ุฃู ุงุฎุชูุงุฑ ูู ุงูุดุงุดุฉ             โ
โ     โ ุชุนุฏูู ุงููููุฉ ูุงูุณุนุฑ                           โ
โ     โ ุญุณุงุจ ุงูุฅุฌูุงูู ุชููุงุฆูุงู                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  6๏ธโฃ ุงูุญูุธ ุงููุคูุช                                   โ
โ     โ ุงูุถุบุท ุนูู "ุฏูุน ูุญูุธ"                         โ
โ     โ ุฅุฏุฎุงู ุงูุจูุงูุงุช ูู modal                       โ
โ     โ ุงุฎุชูุงุฑ "ุญูุธ ุงูุทูุจ" (ุจุฏูู ุฏูุน ูุงูู)           โ
โ     โ ุงูุทุงููุฉ ุชุจูู ูุดุบููุฉ                          โ
โ     โ order_status = 'active'                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  7๏ธโฃ ุงูุฏูุน ุงูููุงุฆู                                  โ
โ     โ ุงูุถุบุท ุนูู "ุฏูุน ูุญูุธ"                         โ
โ     โ ุฅุฏุฎุงู ุงููุจูุบ ุงููุฏููุน โฅ ุงูุตุงูู                โ
โ     โ ุงุฎุชูุงุฑ "ุญูุธ ูุทุจุงุนุฉ" ุฃู "ุญูุธ ุงูุทูุจ"           โ
โ     โ ุงูุทุงููุฉ ุชุตุจุญ ูุงุถูุฉ                           โ
โ     โ order_status = 'completed'                    โ
โ     โ table_case = 0                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  8๏ธโฃ ุทุจุงุนุฉ ุงููุงุชูุฑุฉ (ุงุฎุชูุงุฑู)                      โ
โ     โ ูุชุญ ุตูุญุฉ ุงูุทุจุงุนุฉ                             โ
โ     โ ุทุจุงุนุฉ ุงูุฅูุตุงู                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐๏ธ ุงูุชุบููุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### **1. ุฌุฏูู `ot_head` (ุฑุฃุณ ุงูุทูุจ)**

```sql
-- ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ
ALTER TABLE `ot_head` 
ADD COLUMN `table_id` INT(11) NULL AFTER `id`,
ADD COLUMN `order_status` ENUM('draft','active','completed','cancelled') 
    DEFAULT 'active' AFTER `table_id`;

-- ุฅุถุงูุฉ ููุงุฑุณ ููุฃุฏุงุก
ALTER TABLE `ot_head` 
ADD INDEX `idx_table_id` (`table_id`),
ADD INDEX `idx_order_status` (`order_status`),
ADD INDEX `idx_table_status` (`table_id`, `order_status`);
```

### **2. ุฌุฏูู `tables` (ุงูุทุงููุงุช)**

```sql
-- ุงููููู ุงูููุฌูุฏ
CREATE TABLE `tables` (
  `id` INT(11) PRIMARY KEY AUTO_INCREMENT,
  `tname` VARCHAR(255) NOT NULL,
  `table_case` INT(11) DEFAULT 0,  -- 0=ูุงุถูุฉ, 1=ูุดุบููุฉ
  `crtime` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `mdtime` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `isdeleted` TINYINT(1) DEFAULT 0,
  `branch` VARCHAR(255),
  `tatnet` VARCHAR(255)
);
```

---

## ๐ป ุงููููุงุช ุงููุนุฏูุฉ

### **1. pos_barcode.php**
- โ ุฅุถุงูุฉ modal ููุทุงููุงุช
- โ ุฅุถุงูุฉ ุฒุฑ "ุงุฎุชุฑ ุทุงููุฉ"
- โ ุฅุถุงูุฉ ุญููู ูุฎููุฉ: `table_id`, `table_name`, `edit`
- โ ุฅุถุงูุฉ JavaScript ูุงุฎุชูุงุฑ ุงูุทุงููุฉ
- โ ุฅุถุงูุฉ ุฏุงูุฉ `loadOrderData()` ูุชุญููู ุงูุทูุจ ุงููุดุท
- โ ุฅุถุงูุฉ ุฏุงูุฉ `selectNoTable()` ููุทูุจุงุช ุจุฏูู ุทุงููุฉ

### **2. do/doadd_invoice.php**
- โ ุฅุถุงูุฉ ูุนุงูุฌุฉ `table_id` ู `order_status`
- โ ุชุญุฏูุซ ุงูุทุงููุฉ ุนูุฏ ุงูุญูุธ (table_case = 1)
- โ ุชูุฑูุบ ุงูุทุงููุฉ ุนูุฏ ุงูุฏูุน ุงููุงูู (table_case = 0)
- โ ุชุบููุฑ ุญุงูุฉ ุงูุทูุจ ุนูุฏ ุงูุฏูุน ุงููุงูู (order_status = 'completed')

### **3. ajax/load_order.php** (ููู ุฌุฏูุฏ)
- โ ุชุญููู ุจูุงูุงุช ุฑุฃุณ ุงูุทูุจ
- โ ุชุญููู ุฃุตูุงู ุงูุทูุจ
- โ ุฅุฑุฌุงุน JSON ุจุงูุจูุงูุงุช ูููุงุฌูุฉ

### **4. update_tables_system.sql** (ููู ุฌุฏูุฏ)
- โ SQL statements ูุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### **5. run_table_updates.php** (ููู ุฌุฏูุฏ)
- โ ุตูุญุฉ ุชูููุฐ ุงูุชุญุฏูุซุงุช ุชููุงุฆูุงู
- โ ุนุฑุถ ุงููุชุงุฆุฌ ููููู ุงูุฌุฏูู

---

## ๐ ููููุฉ ุงูุชุซุจูุช

### **ุงูุฎุทูุฉ 1: ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช**

ุงูุชุญ ุงููุชุตูุญ ูุงูุชูู ุฅูู:
```
http://localhost/horstec/run_table_updates.php
```

ุณุชุธูุฑ ุตูุญุฉ ุชููู ุจู:
- โ ุฅุถุงูุฉ ุญูู `table_id` ูู `ot_head`
- โ ุฅุถุงูุฉ ุญูู `order_status` ูู `ot_head`
- โ ุฅุถุงูุฉ ุงูููุงุฑุณ ุงููุทููุจุฉ
- โ ุนุฑุถ ูุชูุฌุฉ ูู ุงุณุชุนูุงู

### **ุงูุฎุทูุฉ 2: ุงุฎุชุจุงุฑ ุงููุธุงู**

1. ุงูุชุญ `pos_barcode.php`
2. ุงุถุบุท ุนูู ุฒุฑ "ุงุฎุชุฑ ุทุงููุฉ"
3. ุงุฎุชุฑ ุทุงููุฉ ูู ุงููุงุฆูุฉ
4. ุฃุถู ุจุนุถ ุงูุฃุตูุงู
5. ุงุถุบุท "ุฏูุน ูุญูุธ"
6. ุงุญูุธ ุงูุทูุจ (ุจุฏูู ุฏูุน ูุงูู)
7. ุงุฑุฌุน ูู `pos_barcode.php`
8. ุงุฎุชุฑ ููุณ ุงูุทุงููุฉ
9. ุณุชุฌุฏ ุงูุฃุตูุงู ูุญููุฉ ุชููุงุฆูุงู โจ
10. ุฃุถู ุงููุจูุบ ุงููุฏููุน ุจุงููุงูู
11. ุงุญูุธ โ ุงูุทุงููุฉ ุณุชุตุจุญ ูุงุถูุฉ ๐

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### โ **ูุดููุฉ: modal ุงูุทุงููุงุช ูุง ูุธูุฑ**
```javascript
// ุชุฃูุฏ ูู ูุฌูุฏ Bootstrap JS
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
```

### โ **ูุดููุฉ: ุงูุทูุจ ูุง ูุชุญูู**
```
- ุชุฃูุฏ ูู ูุฌูุฏ ููู ajax/load_order.php
- ุงูุชุญ Console ูู ุงููุชุตูุญ
- ุงุจุญุซ ุนู ุฑุณุงุฆู ุงูุฎุทุฃ
```

### โ **ูุดููุฉ: ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
```sql
-- ุชุฃูุฏ ูู ูุฌูุฏ ุงูุญููู
DESCRIBE ot_head;

-- ูุฌุจ ุฃู ุชุฑู:
-- table_id
-- order_status
```

### โ **ูุดููุฉ: ุงูุทุงููุฉ ูุง ุชุชูุฑุบ**
```
- ุชุฃูุฏ ูู ุฃู ุงููุจูุบ ุงููุฏููุน >= ุงูุตุงูู
- ุชุญูู ูู ููู do/doadd_invoice.php
- ุงูููุฏ ูุฌุจ ุฃู ูุญุชูู ุนูู:
  if ($remaining <= 0) { ... }
```

---

## ๐ ุงูุงุณุชุนูุงูุงุช ุงููููุฏุฉ

### **ุนุฑุถ ุฌููุน ุงูุทูุจุงุช ุงููุดุทุฉ ููุทุงููุงุช**
```sql
SELECT 
    t.tname AS 'ุงูุทุงููุฉ',
    oh.id AS 'ุฑูู ุงูุทูุจ',
    oh.net AS 'ุงูุตุงูู',
    oh.paid AS 'ุงููุฏููุน',
    oh.order_status AS 'ุงูุญุงูุฉ',
    oh.pro_date AS 'ุงูุชุงุฑูุฎ'
FROM ot_head oh
JOIN tables t ON t.id = oh.table_id
WHERE oh.order_status = 'active'
ORDER BY oh.pro_date DESC;
```

### **ุนุฑุถ ุงูุทุงููุงุช ุงููุดุบููุฉ ูุฅุฌูุงูู ุทูุจุงุชูุง**
```sql
SELECT 
    t.id,
    t.tname AS 'ุงูุทุงููุฉ',
    t.table_case AS 'ุงูุญุงูุฉ',
    COUNT(oh.id) AS 'ุนุฏุฏ ุงูุทูุจุงุช ุงููุดุทุฉ',
    SUM(oh.net) AS 'ุงูุฅุฌูุงูู'
FROM tables t
LEFT JOIN ot_head oh ON oh.table_id = t.id AND oh.order_status = 'active'
WHERE t.isdeleted = 0
GROUP BY t.id
ORDER BY t.tname;
```

### **ุชูุฑูุบ ุฌููุน ุงูุทุงููุงุช (ููุงุฎุชุจุงุฑ)**
```sql
UPDATE tables SET table_case = 0 WHERE isdeleted = 0;
UPDATE ot_head SET order_status = 'completed' WHERE order_status = 'active';
```

---

## ๐จ ุงูุชุฎุตูุต

### **ุชุบููุฑ ุฃููุงู ุงูุทุงููุงุช**
```css
/* ูู pos_barcode.php ุฃู dist/css/pos.css */

/* ุทุงููุฉ ูุชุงุญุฉ */
.table-select-btn.btn-success {
    background-color: #28a745 !important;
}

/* ุทุงููุฉ ูุดุบููุฉ */
.table-select-btn.btn-danger {
    background-color: #dc3545 !important;
}
```

### **ุฅุถุงูุฉ ูุนูููุงุช ุฅุถุงููุฉ ููุทุงููุฉ**
```php
// ูู pos_barcode.php - modal ุงูุทุงููุงุช
while ($rowtable = $restables->fetch_assoc()) {
    // ... ุงูููุฏ ุงูููุฌูุฏ
    
    // ุฅุถุงูุฉ ูุนูููุงุช ุฅุถุงููุฉ
    $branch = $rowtable['branch'] ?: 'ุงููุฑุน ุงูุฑุฆูุณู';
    echo '<small class="text-muted">' . $branch . '</small>';
}
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุทูุจุงุช ุจุฏูู ุทุงููุฉ**: ูููู ุงุฎุชูุงุฑ "ุจุฏูู ุทุงููุฉ (ุชูู ุฃูุงู)" ูู modal ุงูุทุงููุงุชุ ุณูุชู ุญูุธ `table_id = NULL`

2. **ุชุนุฏุฏ ุงูุทูุจุงุช**: ุญุงููุงูุ ูู ุทุงููุฉ ููุง ุทูุจ ูุดุท ูุงุญุฏ ููุท. ุฅุฐุง ุญูุธุช ุทูุจุงู ุฌุฏูุฏุงู ูููุณ ุงูุทุงููุฉุ ุณูุชู ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ.

3. **ุงูุฏูุน ุงูุฌุฒุฆู**: ุฅุฐุง ุฏูุน ุงูุนููู ุฌุฒุก ูู ุงููุจูุบุ ุงูุทูุจ ูุจูู ูุดุทุงู ูุงูุทุงููุฉ ูุดุบููุฉ.

4. **ุฅูุบุงุก ุงูุทูุจ**: ุญุงููุงู ูุง ููุฌุฏ ุฎูุงุฑ ูุฅูุบุงุก ุงูุทูุจ. ูููู ุฅุถุงูุฉ ูุฐู ุงูููุฒุฉ ูุณุชูุจูุงู.

5. **ุงููุณุฎ ุงูุงุญุชูุงุทู**: ูููุตุญ ุจุฃุฎุฐ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุจู ุชุทุจูู ุงูุชุญุฏูุซุงุช.

---

## ๐ฏ ุงูุชุทููุฑุงุช ุงููุณุชูุจููุฉ

- [ ] ุฅุถุงูุฉ ุฎูุงุฑ ููู ุงูุทูุจ ูู ุทุงููุฉ ูุฃุฎุฑู
- [ ] ุฅุถุงูุฉ ุฎูุงุฑ ุฏูุฌ ุทุงููุชูู
- [ ] ุฅุถุงูุฉ ุชูุฑูุฑ ุฃุฏุงุก ุงูุทุงููุงุช
- [ ] ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ููุทูุจุงุช ุงููุชุฃุฎุฑุฉ
- [ ] ุฅุถุงูุฉ ูุงุฌูุฉ ุฎุงุตุฉ ูููุงุฏู (Waiter App)
- [ ] ุฅุถุงูุฉ ูุธุงู ุญุฌุฒ ุงูุทุงููุงุช

---

## ๐ ุงูุฏุนู ุงูููู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุชุญูู ูู ููู `console` ูู ุงููุชุตูุญ (F12)
2. ุชุญูู ูู ููู `error_log` ูู PHP
3. ุฑุงุฌุน ูุฐุง ุงูุฏููู
4. ุชุฃูุฏ ูู ุชูููุฐ ุฌููุน ุชุญุฏูุซุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## โจ ุชู ุจูุฌุงุญ!

ูุธุงู ุงูุทุงููุงุช ุงูุขู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุจุงููุงูู. ุงุณุชูุชุน ุจุฅุฏุงุฑุฉ ุทูุจุงุช ุงููุทุนู ุจุณูููุฉ! ๐๐ฝ๏ธ

