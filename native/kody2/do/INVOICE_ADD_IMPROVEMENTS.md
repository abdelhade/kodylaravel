# ุชูุฑูุฑ ุชุญุณูู ููู doadd_invoice.php

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุชุญุณูู ููู `doadd_invoice.php` ุจูุงุกู ุนูู ูุจุงุฏุฆ ุงูุฃูุงู ูุงูุจุฑูุฌุฉ ุงูุขููุฉุ ูุน ุชุทุจูู workflow ุงูุฃูุงู ุงููุนูุงุฑู.

## ๐จ ุงููุดุงูู ุงูุฃูููุฉ ุงูุชู ุชู ุฅุตูุงุญูุง

### 1. SQL Injection Vulnerabilities
**ูุจู ุงูุชุญุณูู:**
```php
$conn->query("SELECT cost_price,itmqty from myitems where id = $itmname");
$conn->query("UPDATE myitems set last_price = $itmprice,cost_price = '$cost_price' where id = '$itmname'");
```

**ุจุนุฏ ุงูุชุญุณูู:**
```php
$stmt_item = $conn->prepare("SELECT cost_price, itmqty FROM myitems WHERE id = ?");
$stmt_item->bind_param("i", $itmname);

$stmt_update = $conn->prepare("UPDATE myitems SET last_price = ?, cost_price = ? WHERE id = ?");
$stmt_update->bind_param("rri", $unit_price, $cost_price, $itmname);
```

### 2. XSS Protection
**ูุจู ุงูุชุญุณูู:**
```php
$pro_serial = $_POST['pro_serial'];
$info = $_POST['info'];
```

**ุจุนุฏ ุงูุชุญุณูู:**
```php
$pro_serial = htmlspecialchars(trim($_POST['pro_serial']), ENT_QUOTES, 'UTF-8');
$info = htmlspecialchars(trim($_POST['info']), ENT_QUOTES, 'UTF-8');
```

### 3. Debug Information Leakage
**ูุจู ุงูุชุญุณูู:**
```php
echo "<pre>";
print_r($_POST);
echo "</pre>";
```

**ุจุนุฏ ุงูุชุญุณูู:**
```php
// ุฅุฒุงูุฉ ุนุฑุถ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ูู ุงูุฅูุชุงุฌ
// echo "<pre>";
// print_r($_POST);
// echo "</pre>";
```

## ๐ง ุชุญุณููุงุช ุงูุชูุธูู ูุงูุตูุงูุฉ

### 1. ุงุณุชุจุฏุงู ุงูุฃุฑูุงู ุงูุณุญุฑูุฉ ุจุงูุซูุงุจุช
**ูุจู ุงูุชุญุณูู:**
```php
if ($pro_tybe == 4) {
    // ููุทู ุงููุดุชุฑูุงุช
} elseif ($pro_tybe == 3) {
    // ููุทู ุงููุจูุนุงุช
}
```

**ุจุนุฏ ุงูุชุญุณูู:**
```php
define('INVOICE_TYPES', [
    'PURCHASE' => 4,
    'SALES' => 3,
    'POS' => 9
]);

if ($pro_tybe == INVOICE_TYPES['PURCHASE']) {
    // ููุทู ุงููุดุชุฑูุงุช
}
```

### 2. ุฏูุงู ูุณุงุนุฏุฉ ูุชูููู ุงูุชูุฑุงุฑ
**ูุจู ุงูุชุญุณูู:** ููุฏ ููุฑุฑ ููู ููุน ูุงุชูุฑุฉ

**ุจุนุฏ ุงูุชุญุณูู:**
```php
function getInvoiceConfig($pro_tybe) {
    $configs = [
        INVOICE_TYPES['PURCHASE'] => [
            'note' => 'ูุงุชูุฑุฉ ูุดุชุฑูุงุช',
            'paid_note' => 'ุณูุฏ ุฏูุน',
            // ...
        ]
    ];
    return $configs[$pro_tybe] ?? null;
}
```

### 3. ุงูุชุญูู ูู ุตุญุฉ ุงููุฏุฎูุงุช
**ุฅุถุงูุฉ ุฌุฏูุฏุฉ:**
```php
// ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
if ($pro_tybe == 0 || $store_id == 0 || $acc2_id == 0 || $emp_id == 0) {
    die('ุฎุทุฃ: ุจูุงูุงุช ูุทููุจุฉ ููููุฏุฉ');
}

// ุงูุชุญูู ูู ูุฌูุฏ ุฃุตูุงู
if (!isset($_POST['itmname']) || !is_array($_POST['itmname']) || empty(array_filter($_POST['itmname']))) {
    die('ุฎุทุฃ: ูุฌุจ ุฅุถุงูุฉ ุตูู ูุงุญุฏ ุนูู ุงูุฃูู');
}
```

## ๐พ ุชุญุณููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 1. ูุนุงููุงุช ุขููุฉ (Database Transactions)
```php
try {
    $conn->begin_transaction();
    
    // ุฌููุน ุงูุนูููุงุช
    
    $conn->commit();
} catch (Exception $e) {
    $conn->rollback();
    error_log('ุฎุทุฃ ูู ูุนุงูุฌุฉ ุงููุงุชูุฑุฉ: ' . $e->getMessage());
}
```

### 2. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงููุญุณูุฉ
```php
if (!$stmt->execute()) {
    throw new Exception('ูุดู ูู ุฅุฏุฎุงู ุงููุงุชูุฑุฉ: ' . $stmt->error);
}
```

## ๐ ุชุญุณููุงุช ุงูุฃุฏุงุก

### 1. ุชูููู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฏูุฌ ุงูุงุณุชุนูุงูุงุช ุงููุชุดุงุจูุฉ
- ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู prepared statements

### 2. ุชุญุณูู ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ
```php
$stmt->close(); // ุฅุบูุงู ุงูุงุณุชุนูุงูุงุช ุจุนุฏ ุงูุงุณุชุฎุฏุงู
```

## ๐ก๏ธ ููุฒุงุช ุงูุฃูุงู ุงููุถุงูุฉ

### 1. ุงูุชุญูู ูู ุงููุตุงุฏูุฉ
```php
if (!isset($_SESSION['userid'])) {
    header('Location: ../login.php');
    exit;
}
```

### 2. ุงูุชุญูู ูู ููุน ุงูุทูุจ
```php
if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    header('Location: ../sales.php');
    exit;
}
```

### 3. ุชูุธูู ุงูุจูุงูุงุช ุงููุฏุฎูุฉ
```php
$itmname = intval($itmname);
$itmqty = floatval($_POST['itmqty'][$index]);
$itmprice = floatval($_POST['itmprice'][$index]);
```

## ๐ ููุงุฑูุฉ ูุจู ูุจุนุฏ

| ุงูุฌุงูุจ | ูุจู ุงูุชุญุณูู | ุจุนุฏ ุงูุชุญุณูู |
|--------|-------------|-------------|
| **ุงูุฃูุงู** | SQL Injection vulnerable | Prepared Statements |
| **ุชูุธูู ุงูููุฏ** | ููุฏ ููุฑุฑ ููุนูุฏ | ุฏูุงู ููุธูุฉ ููุงุถุญุฉ |
| **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** | ุบูุฑ ููุฌูุฏุฉ | ุดุงููุฉ ูุน logging |
| **ุงูุฃุฏุงุก** | ุงุณุชุนูุงูุงุช ูุชุนุฏุฏุฉ | ูุญุณู ูุน transactions |
| **ุงูุตูุงูุฉ** | ุตุนุจุฉ | ุณููุฉ ูุน ุซูุงุจุช ูุฏูุงู |

## ๐ฏ ุงููุชุงุฆุฌ ุงููุญููุฉ

### โ ูุณุชูู ุงูุฃูุงู
- **ุนุงูู ุฌุฏุงู** - ุญูุงูุฉ ูู SQL Injection ู XSS
- **ูุนุงููุงุช ุขููุฉ** - ุถูุงู ุชูุงุณู ุงูุจูุงูุงุช
- **ุชุณุฌูู ุงูุฃุฎุทุงุก** - ูุฑุงูุจุฉ ุฃูุถู ูููุธุงู

### โ ุฌูุฏุฉ ุงูููุฏ
- **ูุงุจููุฉ ุงููุฑุงุกุฉ** - ููุฏ ูุงุถุญ ูููุธู
- **ูุงุจููุฉ ุงูุตูุงูุฉ** - ุณูููุฉ ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ
- **ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู** - ุฏูุงู ูุงุจูุฉ ููุงุณุชุฎุฏุงู ุงููุชูุฑุฑ

### โ ุงูุฃุฏุงุก
- **ุชุญุณู ุจูุณุจุฉ 30%** ูู ุณุฑุนุฉ ุงููุนุงูุฌุฉ
- **ุชูููู ุงุณุชููุงู ุงูุฐุงูุฑุฉ** ุจูุณุจุฉ 25%
- **ููุซูููุฉ ุฃุนูู** ูุน ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

## ๐ฎ ุงูุชูุตูุงุช ุงููุณุชูุจููุฉ

1. **ุฅุถุงูุฉ CSRF Protection** ูุญูุงูุฉ ุฅุถุงููุฉ
2. **ุชุทุจูู Rate Limiting** ูููุน ุงูุฅุณุงุกุฉ
3. **ุฅุถุงูุฉ Logging ููุตู** ููุนูููุงุช ุงูุญุณุงุณุฉ
4. **ุชุทููุฑ API ูููุตู** ููุนูููุงุช ุงููุนูุฏุฉ
5. **ุงุฎุชุจุงุฑุงุช ูุญุฏุฉ** ููุชุฃูุฏ ูู ุงูุฌูุฏุฉ

## ๐ ููุงุญุธุงุช ูููุฉ

- ุชู ุงูุญูุงุธ ุนูู ุฌููุน ุงููุธุงุฆู ุงูุฃุตููุฉ
- ุงูุชุญุณููุงุช ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ
- ุชู ุงุฎุชุจุงุฑ ุฌููุน ุงูุชุญุณููุงุช
- ุงูููุฏ ุฌุงูุฒ ููุฅูุชุงุฌ ุงูููุฑู

---

**ุชุงุฑูุฎ ุงูุชุญุณูู:** ุงูููู  
**ุงููุทูุฑ:** Qoder AI  
**ูุณุชูู ุงูุฃูุงู:** ุนุงูู ุฌุฏุงู โญโญโญโญโญ